function getOffsetTop(e){for(var n=e.offsetTop,t=e.offsetParent;t!==null;)n+=t.offsetTop,t=t.offsetParent;return n}(function(e,t,n){var o=function(s,o){this.elem=s,this.$elem=e(s),this.options=o,this.metadata=this.$elem.data("plugin-options"),this.$win=e(t),this.sections={},this.didScroll=!1,this.$doc=e(n),this.docHeight=this.$doc.height()};o.prototype={defaults:{navItems:"a",currentClass:"current",changeHash:!1,easing:"swing",filter:"",scrollSpeed:750,scrollOffset:0,scrollThreshold:.5,begin:!1,end:!1,scrollChange:!1,padding:0,navScrollSpeed:300},init:function(){return this.config=e.extend({},this.defaults,this.options,this.metadata),this.$nav=this.$elem.find(this.config.navItems),this.config.filter!==""&&(this.$nav=this.$nav.filter(this.config.filter)),this.$nav.on("click.onePageNav",e.proxy(this.handleClick,this)),this.getPositions(),this.bindInterval(),this.$win.on("resize.onePageNav",e.proxy(this.getPositions,this)),this},adjustNav:function(e,t){e.$elem.find("."+e.config.currentClass).removeClass(e.config.currentClass),t.addClass(e.config.currentClass)},bindInterval:function(){var t,e=this;e.$win.on("scroll.onePageNav",function(){e.didScroll=!0}),e.t=setInterval(function(){t=e.$doc.height(),e.didScroll&&(e.didScroll=!1,e.scrollChange()),t!==e.docHeight&&(e.docHeight=t,e.getPositions())},250)},getHash:function(e){return e.attr("href").split("#")[1]},getPositions:function(){var n,s,o,t=this;t.$nav.each(function(){n=t.getHash(e(this)),s=e("#"+n),s.length&&(o=s.offset().top,t.sections[n]=Math.round(o))})},getSection:function(e){var n,t=null,s=Math.round(this.$win.height()*this.config.scrollThreshold);for(n in this.sections)if(this.sections[n]-this.config.padding-this.config.scrollOffset-s<e)t=n;else break;return t},handleClick:function(n){var s=this,i=e(n.currentTarget),o=i.parent(),a="#"+s.getHash(i),r=o[0].offsetTop-s.$elem.height()/2;o.hasClass(s.config.currentClass)||(s.config.begin&&s.config.begin(),s.adjustNav(s,o),s.unbindInterval(),s.scrollTo(a,function(){s.config.changeHash&&(t.location.hash=a),s.$elem.animate({scrollTop:r},s.config.navScrollSpeed),s.bindInterval(),s.config.end&&s.config.end()})),n.preventDefault()},scrollChange:function(){var e,t,s=this.$win.scrollTop(),n=this.getSection(s);n!==null?(e=this.$elem.find('a[href$="#'+n+'"]').parent(),e.hasClass(this.config.currentClass)||(t=e[0].offsetTop-this.$elem.height()/2,this.$elem.animate({scrollTop:t},this.config.navScrollSpeed),this.adjustNav(this,e),this.config.scrollChange&&this.config.scrollChange(e))):(e=this.$elem.find("."+this.config.currentClass),e.removeClass(this.config.currentClass),t=0,t!=this.$elem.scrollTop()+this.$elem.height()-this.$nav.last().parent().height()&&this.$elem.animate({scrollTop:t},this.config.navScrollSpeed))},scrollTo:function(t,n){var s=e(t).offset().top-this.config.padding-this.config.scrollOffset;e("html, body").animate({scrollTop:s},this.config.scrollSpeed,this.config.easing,n)},unbindInterval:function(){clearInterval(this.t),this.$win.unbind("scroll.onePageNav")}},o.defaults=o.prototype.defaults,e.fn.onePageNav=function(e){return this.each(function(){new o(this,e).init()})}})(jQuery,window,document)